<Window x:Class="AMDownloader.MainWindow" xmlns:local="clr-namespace:AMDownloader" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity" xmlns:properties="clr-namespace:AMDownloader.Properties" xmlns:fa5="http://schemas.fontawesome.com/icons/" mc:Ignorable="d" Title="AM Downloader" Height="{Binding Source={x:Static properties:Settings.Default}, Path=MainWindowHeight, Mode=TwoWay}" MinHeight="270" Width="{Binding Source={x:Static properties:Settings.Default}, Path=MainWindowWidth, Mode=TwoWay}" MinWidth="600" Top="{Binding Source={x:Static properties:Settings.Default}, Path=MainWindowTop, Mode=TwoWay}" Left="{Binding Source={x:Static properties:Settings.Default}, Path=MainWindowLeft, Mode=TwoWay}" Closing="Window_Closing" Icon="/app.ico">
    <Window.Resources>
        <local:ProgressBarVisibilityConverter x:Key="ProgressBarVisbilityConverter" />
        <local:DownloaderSizeConverter x:Key="DownloaderSizeConverter" />
        <local:DownloaderSpeedConverter x:Key="DownloaderSpeedConverter" />
        <local:DownloaderStatusConverter x:Key="DownloaderStatusConverter" />
        <local:QueuedCountConverter x:Key="QueuedCountConverter" />
        <local:FinishedCountConverter x:Key="FinishedCountConverter" />
        <local:VerifyingCountConverter x:Key="VerifyingCountConverter" />
        <local:StatusBarItemVisibilityConverter x:Key="StatusBarItemVisibilityConverter" />
        <local:StatusBarBusyIconVisibilityConverter x:Key="StatusBarBusyIconVisibilityConverter" />
        <local:DownloaderDateConverter x:Key="DownloaderDateConverter" />
        <local:DownloaderDestinationConverter x:Key="DownloaderDestinationConverter" />
        <local:DownloaderDestinationPathConverter x:Key="DownloaderDestinationPathConverter" />
        <local:DownloaderTypeConverter x:Key="DownloaderTypeConverter" />
        <local:DownloaderIconConverter x:Key="DownloaderIconConverter" />
        <local:DownloaderEtaConverter x:Key="DownloaderEtaConverter" />
        <local:TaskBarProgressConverter x:Key="TaskBarProgressConverter" />
        <local:TaskBarProgressStateConverter x:Key="TaskBarProgressStateConverter" />
        <local:TreeViewCountConverter x:Key="TreeViewCountConverter" />
    </Window.Resources>
    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Closing">
            <i:InvokeCommandAction Command="{Binding CloseAppCommand, Mode=OneTime}" />
        </i:EventTrigger>
    </i:Interaction.Triggers>
    <Window.TaskbarItemInfo>
        <TaskbarItemInfo ProgressState="{Binding Progress, Converter={StaticResource TaskBarProgressStateConverter}}" ProgressValue="{Binding Progress, Converter={StaticResource TaskBarProgressConverter}}" />
    </Window.TaskbarItemInfo>
    <DockPanel>
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="_File" TabIndex="9">
                <MenuItem Command="{Binding ClearFinishedDownloadsCommand}" Header="Clear finished downloads" />
                <MenuItem Header="_Options" CommandParameter="{Binding RelativeSource={RelativeSource AncestorType={x:Type Window}}}" Command="{Binding OptionsCommand}" />
                <Separator />
                <MenuItem x:Name="menuExit" Header="E_xit" Click="menuExit_Click" />
            </MenuItem>
            <MenuItem Header="_Help" TabIndex="10">
                <MenuItem x:Name="menuAbout" Header="_About" Click="menuAbout_Click" />
            </MenuItem>
        </Menu>
        <ToolBarTray DockPanel.Dock="Top">
            <ToolBar>
                <Button Padding="10" x:Name="btnAdd" CommandParameter="{Binding RelativeSource={RelativeSource AncestorType={x:Type Window}}}" Command="{Binding AddCommand}" TabIndex="2">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontSize="18" Text="&#xf055;" FontFamily="{StaticResource FontAwesomeSolid}" Foreground="LightSeaGreen" />
                        <TextBlock Margin="5 0 0 0" VerticalAlignment="Center" Text="Add" />
                    </StackPanel>
                </Button>
                <Button CommandParameter="{Binding SelectedItems, ElementName=lvDownload}" Command="{Binding RemoveFromListCommand}" Padding="10" x:Name="btnRemove" TabIndex="3">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontSize="18" Text="&#xf056;" FontFamily="{StaticResource FontAwesomeSolid}" Foreground="#FFFF8686" />
                        <TextBlock Margin="5 0 0 0" VerticalAlignment="Center" Text="Remove" />
                    </StackPanel>
                </Button>
                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" />
                <Button Padding="10" x:Name="btnStart" CommandParameter="{Binding Path=SelectedItems, ElementName=lvDownload}" Command="{Binding StartCommand}" TabIndex="4">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontSize="18" Text="&#xf144;" FontFamily="{StaticResource FontAwesomeSolid}" Foreground="#FF7BCB00" />
                        <TextBlock Margin="5 0 0 0" VerticalAlignment="Center" Text="Start" />
                    </StackPanel>
                </Button>
                <Button Padding="10" x:Name="btnPause" CommandParameter="{Binding SelectedItems, ElementName=lvDownload}" Command="{Binding PauseCommand}" TabIndex="5">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontSize="18" Text="&#xf28b;" FontFamily="{StaticResource FontAwesomeSolid}" Foreground="Orange" />
                        <TextBlock Margin="5 0 0 0" VerticalAlignment="Center" Text="Pause" />
                    </StackPanel>
                </Button>
                <Button Padding="10" x:Name="btnCancel" CommandParameter="{Binding SelectedItems, ElementName=lvDownload}" Command="{Binding CancelCommand}" TabIndex="6">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontSize="18" Text="&#xf28d;" FontFamily="{StaticResource FontAwesomeSolid}" Foreground="#FFFF6565" />
                        <TextBlock Margin="5 0 0 0" VerticalAlignment="Center" Text="Cancel" />
                    </StackPanel>
                </Button>
                <Separator Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" />
                <Button Padding="10" x:Name="btnStartQueue" Command="{Binding StartQueueCommand}" CommandParameter="{Binding SelectedItems, ElementName=lvDownload}" TabIndex="7">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontSize="18" Text="&#xf144;" FontFamily="{StaticResource FontAwesomeSolid}" Foreground="Lime" />
                        <TextBlock Margin="5 0 0 0" VerticalAlignment="Center" Text="Start Queue" />
                    </StackPanel>
                </Button>
                <Button Padding="10" x:Name="btnCancelQueue" Command="{Binding StopQueueCommand}" TabIndex="8">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock FontSize="18" Text="&#xf28d;" FontFamily="{StaticResource FontAwesomeSolid}" Foreground="Red" />
                        <TextBlock Margin="5 0 0 0" VerticalAlignment="Center" Text="Stop Queue" />
                    </StackPanel>
                </Button>
            </ToolBar>
        </ToolBarTray>
        <DockPanel DockPanel.Dock="Bottom">
            <StatusBar Padding="5">
                <StatusBar.ItemsPanel>
                    <ItemsPanelTemplate>
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="auto" />
                            </Grid.ColumnDefinitions>
                        </Grid>
                    </ItemsPanelTemplate>
                </StatusBar.ItemsPanel>
                <StatusBarItem>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Margin="0 0 4 0" VerticalAlignment="Center" Visibility="{Binding Status, Converter={StaticResource StatusBarBusyIconVisibilityConverter}}" Text="&#xf252;" FontFamily="{StaticResource FontAwesomeSolid}" />
                        <TextBlock TextTrimming="CharacterEllipsis" Grid.Column="1" Text="{Binding Status, Converter={StaticResource DownloaderStatusConverter}}" />
                    </Grid>
                </StatusBarItem>
                <StatusBarItem Grid.Column="1" Visibility="{Binding Progress, Converter={StaticResource ProgressBarVisbilityConverter}}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="auto" />
                        </Grid.ColumnDefinitions>
                        <TextBlock VerticalAlignment="Center" Text="{Binding Progress, StringFormat=\{0:0\}%}" Margin="0 0 4 0" />
                        <ProgressBar VerticalAlignment="Center" Grid.Column="1" x:Name="pbProgress" Value="{Binding Progress, Mode=OneWay}" Width="100" Height="16" />
                    </Grid>
                </StatusBarItem>
                <StatusBarItem Margin="20 0 0 0" Grid.Column="2" Visibility="{Binding Path=Text, ElementName=tbVerifyingCount, Converter={StaticResource StatusBarItemVisibilityConverter}}">
                    <TextBlock>
                        <TextBlock Margin="0 0 4 0" Text="&#xf12a;" FontFamily="{StaticResource FontAwesomeSolid}" />
                        <TextBlock x:Name="tbVerifyingCount" Text="{Binding VerifyingCount, Converter={StaticResource VerifyingCountConverter}}" />
                    </TextBlock>
                </StatusBarItem>
                <StatusBarItem Margin="20 0 0 0" Grid.Column="3" Visibility="{Binding Path=Text, ElementName=tbQueuedCount, Converter={StaticResource StatusBarItemVisibilityConverter}}">
                    <TextBlock>
                        <TextBlock Margin="0 0 4 0" Text="&#xf0ae;" FontFamily="{StaticResource FontAwesomeSolid}" />
                        <TextBlock x:Name="tbQueuedCount" Text="{Binding QueuedCount, Converter={StaticResource QueuedCountConverter}}" />
                    </TextBlock>
                </StatusBarItem>
                <StatusBarItem Margin="20 0 0 0" Grid.Column="4" Visibility="{Binding Path=Text, ElementName=tbFinishedCount, Converter={StaticResource StatusBarItemVisibilityConverter}}">
                    <TextBlock>
                        <TextBlock Margin="0 0 4 0" Text="&#xf00c;" FontFamily="{StaticResource FontAwesomeSolid}" />
                        <TextBlock x:Name="tbFinishedCount" Text="{Binding FinishedCount, Converter={StaticResource FinishedCountConverter}}" />
                    </TextBlock>
                </StatusBarItem>
                <StatusBarItem Margin="20 0 0 0" Grid.Column="5" Visibility="{Binding Path=Text, ElementName=tbBytesDownloaded, Converter={StaticResource StatusBarItemVisibilityConverter}}">
                    <TextBlock>
                        <TextBlock Margin="0 0 4 0" Text="&#xf019;" FontFamily="{StaticResource FontAwesomeSolid}" />
                        <TextBlock x:Name="tbBytesDownloaded" Text="{Binding BytesDownloaded, Converter={StaticResource DownloaderSizeConverter}}" ToolTip="Data transferred this session" />
                    </TextBlock>
                </StatusBarItem>
                <StatusBarItem Margin="20 0 0 0" Grid.Column="6" Visibility="{Binding Path=Text, ElementName=tbSpeed, Converter={StaticResource StatusBarItemVisibilityConverter}}" HorizontalAlignment="Right">
                    <TextBlock>
                        <TextBlock Margin="0 0 4 0" Text="&#xf3fd;" FontFamily="{StaticResource FontAwesomeSolid}" />
                        <TextBlock TextAlignment="Right" x:Name="tbSpeed" Text="{Binding Speed, Converter={StaticResource DownloaderSpeedConverter}}" ToolTip="Current data transfer rate" />
                    </TextBlock>
                </StatusBarItem>
            </StatusBar>
        </DockPanel>
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="150" />
                <ColumnDefinition Width="auto" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <TreeView x:Name="tvCategories" TabIndex="0">
                <i:Interaction.Triggers>
                    <i:EventTrigger EventName="SelectedItemChanged">
                        <i:InvokeCommandAction Command="{Binding CategoryChangedCommand}" CommandParameter="{Binding ElementName=tvCategories, Path=SelectedItem}" />
                    </i:EventTrigger>
                </i:Interaction.Triggers>
                <TreeView.Resources>
                    <ControlTemplate TargetType="TreeViewItem" x:Key="QueuedTemplate">
                        <Grid Background="{TemplateBinding Background}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="25" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="auto" />
                            </Grid.ColumnDefinitions>
                            <Ellipse Width="12" Height="12" Fill="SandyBrown" />
                            <TextBlock TextTrimming="CharacterEllipsis" Grid.Column="1" VerticalAlignment="Center" Text="{Binding}" />
                            <TextBlock Grid.Column="2" HorizontalAlignment="Right" VerticalAlignment="Center" Text="{Binding DataContext.QueuedCount, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource TreeViewCountConverter}}" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                        </Grid>
                    </ControlTemplate>
                    <ControlTemplate TargetType="TreeViewItem" x:Key="DownloadTemplate">
                        <Grid Background="{TemplateBinding Background}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="25" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="auto" />
                            </Grid.ColumnDefinitions>
                            <Ellipse Width="12" Height="12" Fill="LimeGreen" />
                            <TextBlock TextTrimming="CharacterEllipsis" Grid.Column="1" VerticalAlignment="Center" Text="{Binding}" />
                            <TextBlock Grid.Column="2" HorizontalAlignment="Right" VerticalAlignment="Center" Text="{Binding DataContext.DownloadingCount, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource TreeViewCountConverter}}" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                        </Grid>
                    </ControlTemplate>
                    <ControlTemplate TargetType="TreeViewItem" x:Key="AllTemplate">
                        <Grid Background="{TemplateBinding Background}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="25" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="auto" />
                            </Grid.ColumnDefinitions>
                            <Ellipse Width="12" Height="12" Fill="DarkSlateBlue" />
                            <TextBlock TextTrimming="CharacterEllipsis" Grid.Column="1" VerticalAlignment="Center" Text="{Binding}" />
                            <TextBlock Grid.Column="2" HorizontalAlignment="Right" VerticalAlignment="Center" Text="{Binding DataContext.Count, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource TreeViewCountConverter}}" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                        </Grid>
                    </ControlTemplate>
                    <ControlTemplate TargetType="TreeViewItem" x:Key="ReadyTemplate">
                        <Grid Background="{TemplateBinding Background}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="25" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="auto" />
                            </Grid.ColumnDefinitions>
                            <Ellipse Width="12" Height="12" Fill="LightSeaGreen" />
                            <TextBlock TextTrimming="CharacterEllipsis" Grid.Column="1" VerticalAlignment="Center" Text="{Binding}" />
                            <TextBlock Grid.Column="2" HorizontalAlignment="Right" VerticalAlignment="Center" Text="{Binding DataContext.ReadyCount, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource TreeViewCountConverter}}" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                        </Grid>
                    </ControlTemplate>
                    <ControlTemplate TargetType="TreeViewItem" x:Key="PausedTemplate">
                        <Grid Background="{TemplateBinding Background}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="25" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="auto" />
                            </Grid.ColumnDefinitions>
                            <Ellipse Width="12" Height="12" Fill="Gold" />
                            <TextBlock TextTrimming="CharacterEllipsis" Grid.Column="1" VerticalAlignment="Center" Text="{Binding}" />
                            <TextBlock Grid.Column="2" HorizontalAlignment="Right" VerticalAlignment="Center" Text="{Binding DataContext.PausedCount, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource TreeViewCountConverter}}" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                        </Grid>
                    </ControlTemplate>
                    <ControlTemplate TargetType="TreeViewItem" x:Key="ErrorTemplate">
                        <Grid Background="{TemplateBinding Background}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="25" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="auto" />
                            </Grid.ColumnDefinitions>
                            <Ellipse Width="12" Height="12" Fill="Red" />
                            <TextBlock TextTrimming="CharacterEllipsis" Grid.Column="1" VerticalAlignment="Center" Text="{Binding}" />
                            <TextBlock Grid.Column="2" HorizontalAlignment="Right" VerticalAlignment="Center" Text="{Binding DataContext.ErroredCount, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource TreeViewCountConverter}}" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                        </Grid>
                    </ControlTemplate>
                    <ControlTemplate TargetType="TreeViewItem" x:Key="FinishedTemplate">
                        <Grid Background="{TemplateBinding Background}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="25" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="auto" />
                            </Grid.ColumnDefinitions>
                            <Ellipse Width="12" Height="12" Fill="LightSlateGray" />
                            <TextBlock TextTrimming="CharacterEllipsis" Grid.Column="1" VerticalAlignment="Center" Text="{Binding}" />
                            <TextBlock Grid.Column="2" HorizontalAlignment="Right" VerticalAlignment="Center" Text="{Binding DataContext.FinishedCount, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource TreeViewCountConverter}}" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                        </Grid>
                    </ControlTemplate>
                    <ControlTemplate TargetType="TreeViewItem" x:Key="VerifyingTemplate">
                        <Grid Background="{TemplateBinding Background}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="25" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="auto" />
                            </Grid.ColumnDefinitions>
                            <Ellipse Width="12" Height="12" Fill="Yellow" />
                            <TextBlock TextTrimming="CharacterEllipsis" Grid.Column="1" VerticalAlignment="Center" Text="{Binding}" />
                            <TextBlock Grid.Column="2" HorizontalAlignment="Right" VerticalAlignment="Center" Text="{Binding DataContext.VerifyingCount, RelativeSource={RelativeSource AncestorType=Window}, Converter={StaticResource TreeViewCountConverter}}" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                        </Grid>
                    </ControlTemplate>
                </TreeView.Resources>
                <TreeView.ItemContainerStyle>
                    <Style TargetType="{x:Type TreeViewItem}">
                        <Style.Resources>
                            <Style TargetType="{x:Type Ellipse}">
                                <Setter Property="Margin" Value="5 0 0 0" />
                            </Style>
                            <Style TargetType="{x:Type TextBlock}">
                                <Setter Property="Margin" Value="5 0 5 0" />
                            </Style>
                        </Style.Resources>
                        <Style.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter Property="Background" Value="PowderBlue" />
                                <Setter Property="FontWeight" Value="Bold" />
                            </Trigger>
                            <DataTrigger Binding="{Binding}" Value="Downloading">
                                <Setter Property="Template" Value="{StaticResource DownloadTemplate}" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding}" Value="Queued">
                                <Setter Property="Template" Value="{StaticResource QueuedTemplate}" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding}" Value="All">
                                <Setter Property="Template" Value="{StaticResource AllTemplate}" />
                                <Setter Property="IsSelected" Value="True" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding}" Value="Ready">
                                <Setter Property="Template" Value="{StaticResource ReadyTemplate}" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding}" Value="Paused">
                                <Setter Property="Template" Value="{StaticResource PausedTemplate}" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding}" Value="Errored">
                                <Setter Property="Template" Value="{StaticResource ErrorTemplate}" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding}" Value="Finished">
                                <Setter Property="Template" Value="{StaticResource FinishedTemplate}" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding}" Value="Verifying">
                                <Setter Property="Template" Value="{StaticResource VerifyingTemplate}" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </TreeView.ItemContainerStyle>
            </TreeView>
            <GridSplitter Grid.Column="1" Width="3" HorizontalAlignment="Stretch" />
            <ListView x:Name="lvDownload" TabIndex="1" Grid.Column="2">
                <ListView.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Open" Command="{Binding OpenCommand}" CommandParameter="{Binding PlacementTarget.SelectedItems, RelativeSource={RelativeSource AncestorType=ContextMenu}}" />
                        <MenuItem Header="Open folder" Command="{Binding OpenContainingFolderCommand}" CommandParameter="{Binding PlacementTarget.SelectedItems, RelativeSource={RelativeSource AncestorType=ContextMenu}}" />
                        <MenuItem Header="Copy link" Command="{Binding CopyLinkToClipboardCommand}" CommandParameter="{Binding PlacementTarget.SelectedItems, RelativeSource={RelativeSource AncestorType=ContextMenu}}" />
                        <Separator />
                        <MenuItem Header="Start" Command="{Binding StartCommand}" CommandParameter="{Binding PlacementTarget.SelectedItems, RelativeSource={RelativeSource AncestorType=ContextMenu}}" />
                        <MenuItem Header="Pause" Command="{Binding PauseCommand}" CommandParameter="{Binding PlacementTarget.SelectedItems, RelativeSource={RelativeSource AncestorType=ContextMenu}}" />
                        <MenuItem Header="Cancel" Command="{Binding CancelCommand}" CommandParameter="{Binding PlacementTarget.SelectedItems, RelativeSource={RelativeSource AncestorType=ContextMenu}}" />
                        <Separator />
                        <MenuItem Header="Enqueue" Command="{Binding EnqueueCommand}" CommandParameter="{Binding PlacementTarget.SelectedItems, RelativeSource={RelativeSource AncestorType=ContextMenu}}" />
                        <MenuItem Header="Dequeue" Command="{Binding DequeueCommand}" CommandParameter="{Binding PlacementTarget.SelectedItems, RelativeSource={RelativeSource AncestorType=ContextMenu}}" />
                        <Separator />
                        <MenuItem Header="Recheck" Command="{Binding RecheckCommand}" CommandParameter="{Binding PlacementTarget.SelectedItems, RelativeSource={RelativeSource AncestorType=ContextMenu}}" />
                        <Separator />
                        <MenuItem Header="Remove from list" Command="{Binding RemoveFromListCommand}" CommandParameter="{Binding PlacementTarget.SelectedItems, RelativeSource={RelativeSource AncestorType=ContextMenu}}" />
                        <MenuItem Header="Delete file" Command="{Binding DeleteFileCommand}" CommandParameter="{Binding PlacementTarget.SelectedItems, RelativeSource={RelativeSource AncestorType=ContextMenu}}" />
                    </ContextMenu>
                </ListView.ContextMenu>
                <ListView.Resources>
                    <DataTemplate x:Key="HeaderTemplate">
                        <TextBlock HorizontalAlignment="Left" Text="{Binding}" Padding="5" />
                    </DataTemplate>
                    <Style x:Key="LeftAligned" TargetType="{x:Type GridViewColumnHeader}">
                        <Setter Property="HorizontalContentAlignment" Value="Left" />
                    </Style>
                    <Style x:Key="MiddleAligned" TargetType="{x:Type GridViewColumnHeader}">
                        <Setter Property="HorizontalContentAlignment" Value="Center" />
                    </Style>
                    <Style x:Key="RightAligned" TargetType="{x:Type GridViewColumnHeader}">
                        <Setter Property="HorizontalContentAlignment" Value="Right" />
                    </Style>
                </ListView.Resources>
                <ListView.ItemContainerStyle>
                    <Style TargetType="{x:Type ListViewItem}">
                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                    </Style>
                </ListView.ItemContainerStyle>
                <ListView.View>
                    <GridView>
                        <GridViewColumn HeaderTemplate="{StaticResource HeaderTemplate}" HeaderContainerStyle="{StaticResource LeftAligned}" Header="Name" Width="250">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <Image Source="{Binding Destination, Converter={StaticResource DownloaderIconConverter}}" Width="16" Height="16" Margin="0 0 3 0" />
                                        <TextBlock Grid.Column="1" Text="{Binding Name}" TextTrimming="CharacterEllipsis" />
                                    </Grid>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn HeaderTemplate="{StaticResource HeaderTemplate}" HeaderContainerStyle="{StaticResource RightAligned}" Header="Type" Width="120">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <TextBlock TextAlignment="Right" Text="{Binding Destination, Converter={StaticResource DownloaderTypeConverter}}" TextTrimming="CharacterEllipsis" />
                                    </Grid>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn HeaderTemplate="{StaticResource HeaderTemplate}" HeaderContainerStyle="{StaticResource LeftAligned}" Header="Status" Width="100">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <TextBlock TextTrimming="CharacterEllipsis" Text="{Binding Status}" />
                                    </Grid>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn HeaderTemplate="{StaticResource HeaderTemplate}" HeaderContainerStyle="{StaticResource MiddleAligned}" Header="Progress" Width="100">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <ProgressBar x:Name="pbProgress" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Minimum="0" Maximum="100" Value="{Binding Progress, Mode=OneWay}" />
                                        <TextBlock Text="{Binding Value, ElementName=pbProgress, StringFormat=\{0:0\}%}" HorizontalAlignment="Center" VerticalAlignment="Center" />
                                    </Grid>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn HeaderTemplate="{StaticResource HeaderTemplate}" HeaderContainerStyle="{StaticResource RightAligned}" Header="Downloaded" Width="100">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <TextBlock TextTrimming="CharacterEllipsis" Text="{Binding TotalBytesCompleted, Converter={StaticResource DownloaderSizeConverter}}" HorizontalAlignment="Right" />
                                    </Grid>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn HeaderTemplate="{StaticResource HeaderTemplate}" HeaderContainerStyle="{StaticResource LeftAligned}" Header="Size" Width="75">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock TextTrimming="CharacterEllipsis" Text="{Binding TotalBytesToDownload, Converter={StaticResource DownloaderSizeConverter}}" />
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn HeaderTemplate="{StaticResource HeaderTemplate}" HeaderContainerStyle="{StaticResource RightAligned}" Header="Speed" Width="75">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <TextBlock TextTrimming="CharacterEllipsis" Text="{Binding Speed, Converter={StaticResource DownloaderSpeedConverter}}" HorizontalAlignment="Right" />
                                    </Grid>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn HeaderTemplate="{StaticResource HeaderTemplate}" HeaderContainerStyle="{StaticResource LeftAligned}" Header="ETA" Width="80">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock TextTrimming="CharacterEllipsis" Text="{Binding TimeRemaining, Converter={StaticResource DownloaderEtaConverter}}" />
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn HeaderTemplate="{StaticResource HeaderTemplate}" HeaderContainerStyle="{StaticResource RightAligned}" Header="Connections" Width="80">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock TextAlignment="Right" TextTrimming="CharacterEllipsis" Text="{Binding NumberOfActiveStreams}" />
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn HeaderTemplate="{StaticResource HeaderTemplate}" HeaderContainerStyle="{StaticResource LeftAligned}" Header="Location" Width="150">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="auto" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Margin="0 0 5 0" TextTrimming="CharacterEllipsis" Text="{Binding Destination, Converter={StaticResource DownloaderDestinationConverter}}" />
                                        <TextBlock Grid.Column="1" TextTrimming="CharacterEllipsis" Text="{Binding Destination, Converter={StaticResource DownloaderDestinationPathConverter}}" Foreground="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}" />
                                    </Grid>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn HeaderTemplate="{StaticResource HeaderTemplate}" HeaderContainerStyle="{StaticResource RightAligned}" Header="URL" Width="400">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock TextAlignment="Right" TextTrimming="CharacterEllipsis" Text="{Binding Url}" />
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn HeaderTemplate="{StaticResource HeaderTemplate}" HeaderContainerStyle="{StaticResource LeftAligned}" Header="Created" Width="150">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <TextBlock TextTrimming="CharacterEllipsis" Text="{Binding DateCreated, Converter={StaticResource DownloaderDateConverter}}" />
                                    </Grid>
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                        <GridViewColumn HeaderTemplate="{StaticResource HeaderTemplate}" HeaderContainerStyle="{StaticResource LeftAligned}" Header="HTTP Status" Width="75">
                            <GridViewColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock TextTrimming="CharacterEllipsis" Text="{Binding StatusCode}" />
                                </DataTemplate>
                            </GridViewColumn.CellTemplate>
                        </GridViewColumn>
                    </GridView>
                </ListView.View>
            </ListView>
        </Grid>
    </DockPanel>
</Window>    